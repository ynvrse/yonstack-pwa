import{j as e,k as U,c}from"./theme-provider-BLIrfkjI.js";import{c as d,b as $,B as l,M as D,G as H,u as O,A as V,f as G,g as R,U as B,X as T,d as r}from"./App-DteNmcQd.js";import{C as N,b as C,c as z,d as q,a as P,L as u}from"./label-B1f5emL6.js";import{v as J,e as W,r as X,g as Y}from"./index-DVYklf_w.js";/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Q=d("camera",K);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],ee=d("log-out",Z);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],te=d("pen",ae);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ie=d("save",se);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],le=d("trash-2",re);function ne({className:t,type:a,...x}){return e.jsx("input",{type:a,"data-slot":"input",className:$("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...x})}function ce(){return e.jsx("div",{className:"bg-background/95 supports-[backdrop-filter]:bg-background/60 border-t backdrop-blur",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-between gap-4 sm:flex-row",children:[e.jsx("div",{className:"text-muted-foreground flex flex-wrap items-center gap-2 text-sm",children:e.jsxs("span",{className:"text-muted-foreground ml-2 text-xs",children:["v",J]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx("a",{href:`mailto:${W}/?subject=${X}`,children:e.jsx(D,{size:16})})}),e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx("a",{href:Y,target:"_blank",rel:"noopener noreferrer",children:e.jsx(H,{size:16})})})]})]})})})}function xe(){var b,k;const{user:t,profile:a,avatar:x,isLoading:M}=O(),g=U(),[j,h]=c.useState(!1),[f,o]=c.useState(!1),[n,p]=c.useState({firstName:"",lastName:"",fullName:""}),v=c.useRef(null);if(c.useEffect(()=>{a&&p({firstName:a.firstName||"",lastName:a.lastName||"",fullName:a.fullName||""})},[a]),M)return e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{className:"border-primary h-8 w-8 animate-spin rounded-full border-b-2"})});const S=async()=>{try{await r.auth.signOut(),g("/")}catch(s){throw console.error(s)}},y=async()=>{if(a!=null&&a.profilePicture)try{await r.storage.delete(a.profilePicture)}catch(s){console.error("Failed to delete old profile picture:",s)}},E=async s=>{if(t!=null&&t.id){o(!0);try{await y();const i=Date.now(),m=s.name.split(".").pop()||"jpg",w=`profiles/${t.id}/avatar_${i}.${m}`,L={contentType:s.type,contentDisposition:"inline"};await r.storage.uploadFile(w,s,L),await r.transact([r.tx.profiles[(a==null?void 0:a.id)||t.id].update({profilePicture:w,updatedAt:new Date().toISOString()})])}catch(i){console.error("Error uploading photo:",i)}finally{o(!1),g("/setting")}}},F=async()=>{if(!(!(t!=null&&t.id)||!(a!=null&&a.profilePicture))){o(!0);try{await y(),await r.transact([r.tx.profiles[a.id||t.id].update({profilePicture:"",updatedAt:new Date().toISOString()})])}catch(s){console.error("Error removing photo:",s)}finally{o(!1)}}},_=s=>{var m;const i=(m=s.target.files)==null?void 0:m[0];if(i){if(!i.type.startsWith("image/")){alert("Please select an image file.");return}if(i.size>5*1024*1024){alert("Please select an image smaller than 5MB.");return}E(i)}s.target.value=""},A=async()=>{if(t!=null&&t.id)try{const s={};n.firstName!==(a==null?void 0:a.firstName)&&(s.firstName=n.firstName),n.lastName!==(a==null?void 0:a.lastName)&&(s.lastName=n.lastName),n.fullName!==(a==null?void 0:a.fullName)&&(s.fullName=n.fullName),Object.keys(s).length>0&&(s.updatedAt=new Date().toISOString(),await r.transact([r.tx.profiles[(a==null?void 0:a.id)||t.id].update(s)])),h(!1)}catch(s){console.error("Error updating profile:",s)}},I=()=>{p({firstName:(a==null?void 0:a.firstName)||"",lastName:(a==null?void 0:a.lastName)||"",fullName:(a==null?void 0:a.fullName)||""}),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between space-y-2 pt-6 pb-4",children:e.jsx("h1",{className:"my-1 text-3xl font-semibold tracking-tight",children:"Your Profile"})}),e.jsxs("div",{className:"mx-auto max-w-2xl space-y-6",children:[e.jsx(N,{children:e.jsxs(C,{className:"text-center",children:[e.jsxs("div",{className:"relative mx-auto",children:[e.jsxs(V,{className:"mx-auto h-24 w-24",children:[e.jsx(G,{src:x,alt:(a==null?void 0:a.fullName)||(t==null?void 0:t.email)||"User"}),e.jsx(R,{className:"text-lg",children:((b=a==null?void 0:a.firstName)==null?void 0:b.charAt(0))||((k=t==null?void 0:t.email)==null?void 0:k.charAt(0))||e.jsx(B,{size:24})})]}),e.jsx(l,{size:"sm",variant:"secondary",className:"absolute -right-2 -bottom-2 h-8 w-8 rounded-full p-0",onClick:()=>{var s;return(s=v.current)==null?void 0:s.click()},disabled:f,title:"Change profile picture",children:f?e.jsx("div",{className:"border-primary h-4 w-4 animate-spin rounded-full border-b-2"}):e.jsx(Q,{size:14})}),(a==null?void 0:a.profilePicture)&&!f&&e.jsx(l,{size:"sm",variant:"destructive",className:"absolute -bottom-2 -left-2 h-8 w-8 rounded-full p-0",onClick:F,title:"Remove profile picture",children:e.jsx(le,{size:14})}),e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:_,className:"hidden"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{className:"text-xl",children:(a==null?void 0:a.fullName)||"Unnamed User"}),e.jsx(q,{className:"text-sm",children:t==null?void 0:t.email})]}),e.jsx("p",{className:"text-muted-foreground mt-2 text-xs",children:"Click camera icon to upload • Max 5MB • JPG, PNG, GIF supported"})]})}),e.jsxs(N,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-lg",children:"Profile Information"}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>h(!0),disabled:j,children:[e.jsx(te,{size:14,className:"mr-2"}),"Edit"]})]}),e.jsx(P,{className:"space-y-4",children:j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"fullName",children:"Full Name"}),e.jsx(ne,{id:"fullName",value:n.fullName,onChange:s=>p(i=>({...i,fullName:s.target.value})),placeholder:"Enter your full name"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(l,{onClick:A,size:"sm",children:[e.jsx(ie,{size:14,className:"mr-2"}),"Save Changes"]}),e.jsxs(l,{variant:"outline",onClick:I,size:"sm",children:[e.jsx(T,{size:14,className:"mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground text-sm font-medium",children:"Full Name"}),e.jsx("p",{className:"text-sm",children:(a==null?void 0:a.fullName)||"-"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground text-sm font-medium",children:"Email"}),e.jsx("p",{className:"text-sm",children:t==null?void 0:t.email})]}),(a==null?void 0:a.updatedAt)&&e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground text-sm font-medium",children:"Last Updated"}),e.jsx("p",{className:"text-sm",children:new Date(a.updatedAt).toLocaleDateString()})]})]})})]}),e.jsx(N,{children:e.jsx(P,{className:"pt-6",children:e.jsxs(l,{onClick:S,variant:"destructive",size:"sm",className:"flex w-full items-center justify-center gap-2 hover:bg-red-500",children:[e.jsx(ee,{size:14}),"Logout"]})})}),e.jsx(ce,{})]})]})}export{xe as default};
